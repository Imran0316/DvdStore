@model DvdStore.Models.NewsPromotion
@{
    Layout = "Dashboard"; // Remove layout temporarily to isolate issues
}

<!DOCTYPE html>
<html>
<head>
    <title>Create News/Promotion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }

        .form-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-container">
            <h2 class="text-center mb-4">Create News/Promotion</h2>

            <!-- Error Display -->
            @if (ViewData.ModelState.ErrorCount > 0)
            {
                <div class="alert alert-danger">
                    <h5>Please fix the following errors:</h5>
                    <ul>
                        @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                        {
                            <li>@error.ErrorMessage</li>
                        }
                    </ul>
                </div>
            }

            <form asp-action="Create" method="post" enctype="multipart/form-data">
                @Html.AntiForgeryToken()

                <div class="row">
                    <!-- Left Column - Required Fields -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="Title" class="form-label">Title *</label>
                            <input asp-for="Title" class="form-control" required>
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Content" class="form-label">Content *</label>
                            <textarea asp-for="Content" class="form-control" rows="5" required></textarea>
                            <span asp-validation-for="Content" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Type" class="form-label">Type *</label>
                            <select asp-for="Type" class="form-select" required>
                                <option value="">-- Select Type --</option>
                                <option value="News">News</option>
                                <option value="Promotion">Promotion</option>
                                <option value="Event">Event</option>
                            </select>
                            <span asp-validation-for="Type" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Right Column - Optional Fields -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Image (Optional)</label>
                            <input type="file" name="imageFile" class="form-control" accept="image/*">
                            <small class="text-muted">Leave empty if no image</small>
                        </div>

                        <div class="mb-3">
                            <label asp-for="PublishDate" class="form-label">Publish Date</label>
                            <input asp-for="PublishDate" type="datetime-local" class="form-control">
                            <span asp-validation-for="PublishDate" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ExpiryDate" class="form-label">Expiry Date (Optional)</label>
                            <input asp-for="ExpiryDate" type="datetime-local" class="form-control">
                            <span asp-validation-for="ExpiryDate" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProductID" class="form-label">Related Product (Optional)</label>
                            <select asp-for="ProductID" class="form-select">
                                <option value="">-- No Product --</option>
                                @if (ViewBag.Products != null)
                                {
                                    foreach (var product in ViewBag.Products)
                                    {
                                        <option value="@product.ProductID">@product.tbl_Albums?.Title</option>
                                    }
                                }
                            </select>
                            <!-- Add validation message -->
                            <span asp-validation-for="ProductID" class="text-danger"></span>
                        </div>

                        <div class="form-check mb-3">
                            <input asp-for="IsActive" class="form-check-input" checked>
                            <label asp-for="IsActive" class="form-check-label">Active</label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-plus"></i> Create News/Promotion
                    </button>
                    <a href="/NewsPromotion/Index" class="btn btn-secondary btn-lg ms-2">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>

    <!-- Client-side Validation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js"></script>

    <script>
        // Set default publish date to current time
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const localDateTime = now.toISOString().slice(0, 16);
            document.querySelector('input[name="PublishDate"]').value = localDateTime;

            console.log('Form loaded successfully');
        });

        // Form submission handler
        $('form').on('submit', function() {
            console.log('Form submitted - validation should occur');
        });
    </script>
</body>
</html>